!function(){"use strict";class e{constructor(e,t){this.lat=e,this.lng=t}}class t{constructor(e,t){this.modalTemplateElem=document.getElementById("modal-template"),this.contentTemplateElem=document.getElementById(e)}show(){if("content"in document.createElement("template")){const e=document.importNode(this.modalTemplateElem.content,!0);this.modalElement=e.querySelector(".modal"),this.backdropElement=e.querySelector(".backdrop");const t=document.importNode(this.contentTemplateElem.content,!0);this.modalElement.appendChild(t),document.body.insertAdjacentElement("afterbegin",this.modalElement),document.body.insertAdjacentElement("afterbegin",this.backdropElement)}else alert(this.fallbackMsg)}hide(){this.modalElement&&(this.modalElement.remove(),this.modalElement=null),this.backdropElement&&(this.backdropElement.remove(),this.backdropElement=null)}}class o{constructor(e,t){this.coordinate=e,this.address=t}render(e){google?this.map=new google.maps.Map(e,{center:{lat:this.coordinate.lat,lng:this.coordinate.lng},zoom:20}):alert("Could not load map!")}mark(){new google.maps.Marker({position:{lat:this.coordinate.lat,lng:this.coordinate.lng},map:this.map})}shareableLink(e){return`${location.origin}/my-place?locationId=${e}`}}class a{static getAPIKey(){return n}}const n="AIzaSyA-2sdob-Q1h1oC9F7JoNt5o2v20jQdF1E";class s{async locateCoordinate(e){const t=encodeURI(e),o=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${t}&key=${a.getAPIKey()}`);if(!o.ok)throw new Error("Failed to fetch co-ordinates!");const n=await o.json();if(n.error_message)throw new Error(n.error_message);return n.results[0].geometry.location}async locateAddress(e){const t=await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${e.lat},${e.lng}&key=${a.getAPIKey()}`);if(!t.ok)throw new Error("Failed to fetch address!");const o=await t.json();if(o.error_message)throw new Error(o.error_message);return o.results[0].formatted_address}}class r{constructor(e){const t=document.getElementById("share-btn");t.disabled=!1,t.addEventListener("click",this.shareBtnHandler.bind(this)),this.shareableBox=document.getElementById("share-link"),this.shareableBox.value=e}shareBtnHandler(){this.shareableBox.select(),navigator.clipboard&&navigator.clipboard.writeText(this.shareableBox.value).then((()=>{alert("copied into clipboard!")})).catch((e=>{alert(e.message)}))}}class l{constructor(){const e=document.querySelector("form"),t=document.getElementById("locate-btn");this.mapDisplayDiv=document.getElementById("map"),e.addEventListener("submit",this.addressHandler.bind(this)),t.addEventListener("click",this.userLocationHandler.bind(this))}async userLocationHandler(){if(!navigator.geolocation)return void alert("Could not locate you unfortunately, please use modern browser!");const a=new t("loading-modal-content","Loading please wait!");a.show(),navigator.geolocation.getCurrentPosition((async t=>{const n=t.coords.latitude,l=t.coords.longitude,i=new e(n,l),c=new s,d=await c.locateAddress(i),m=new o(i,d);m.render(this.mapDisplayDiv),m.mark();const h=m.shareableLink();new r(h),a.hide()}),(e=>{alert("Could not locate you unfortunately!"),a.hide()}))}async saveLocation(e,t){const o=await fetch("http://localhost:3000/save-location",{method:"POST",body:JSON.stringify({address:e,lat:t.lat,lng:t.lng}),headers:{"Content-Type":"application/json"}});return(await o.json()).locationId}async addressHandler(e){e.preventDefault();const a=e.target.querySelector("input").value;if(a&&0!=a.trim().length)try{const e=new s;e.locateCoordinate(a);const n=new t("loading-modal-content","Loading please wait!");n.show();const l=await e.locateCoordinate(a),i=new o(l,a);i.render(this.mapDisplayDiv),i.mark();const c=await this.saveLocation(a,l),d=i.shareableLink(c);new r(d),n.hide()}catch(e){modal.hide(),alert(e.message)}else alert("invalid address!")}}(class{static init(){new l}}).init()}();